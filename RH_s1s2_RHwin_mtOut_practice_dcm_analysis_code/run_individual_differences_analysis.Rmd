---
title: "multitask_prac_paramsBehav"
author: "K. Garner"
date: "29/08/2018"
output:
  word_document: default
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(tidyr)
library(ggplot2)
library(psych)
library(nlme)
library(car)
```

### Summary
Having identified the candidate network underpinning modulations in connectivity due to multitasking practice, we sought to identify whether parameter estimates for each subject correlate with the observed behaviour, and whether correlation differences are different between groups. For the modulations associated with practice related changes to single-task performance, we would expect the parameter estimates to correspond to practice-related reductions in single-task RT, and potentially reductions to multitasking costs (given they are at least in part attributable to changes in single task performance)

First we examine the distributions of the data for changes to single-tasks (mean), visual-tasks & auditory tasks, and the b parameters for the LPut -> LIPL connection (the one influenced by practice on single task trials). This determines the correlation performed (i.e. parametric or not parametric). Then we correlate across all p's. If significant, we correlate within group and compare correlation strengths

For the difference in RT for auditory-manual tasks, a negative correlation was found with the Putamen -> SMFC coupling parameter. When broken down by group, this relationship was statistically significant for the control group (-.373) but not for the training group (-.024), even thought the difference between the two groups was not statistically different (p=.08)

### What this code does:
1. load the subject individual parameter estimates 
2. load the behaviour and extract variables of interest - join to the parameter estimate data
3. Plot correlations between parameter estimates and behaviour and perform correlation tests between estimated parameters and observed data

```{r get_b_data, include=FALSE, echo=FALSE}

get.b.data <- function(fname){
  
  dat <- read.csv(fname, header = TRUE)
  dat$sub = as.factor(dat$sub)
  dat$grp = as.factor(dat$grp)
  levels(dat$grp) = c("train", "control")
  # assign parameter name
  dat$con = rep(c("ripl_to_rput", "ripl_to_smfc", "rput_to_ripl", "rput_to_smfc", "smfc_to_ripl", "smfc_to_rput"), times = length(levels(dat$sub)))
  dat$con = as.factor(dat$con)
  dat
}
fname = "~/Dropbox/QBI/mult-conn/multi-practice-repository/RH_s1s2_RHwin_mtOut_practice_dcm_analysis_outdata/behav_correlations/sub_b_params.csv"
params = get.b.data(fname)

# convert to wideform and save for LBA analysis
params.wide = spread(params, con, b)
write.csv(params.wide, file="single_task_practice_params.csv")
cons.of.int = c("rput_to_smfc", "ripl_to_smfc", "ripl_to_rput")
params = params[params$con %in% cons.of.int, ]
params$con = droplevels(params$con)
```


```{r get_behav_data, include=FALSE, echo=FALSE}

get.behav.data <- function(fname){
  # this function assumes that the behavioural data is stored in the below folder
  behav.dat        <- read.csv(fname)
  behav.dat$sub    <- as.factor(behav.dat$sub)
  behav.dat$Group  <- as.factor(behav.dat$Group)
  levels(behav.dat$Group) <- c("train","control")
  
  behav.dat = behav.dat[,c(1:2, 3, 5, 7, 9, 29, 32, 27, 28, 33, 34)]
  behav.dat
}

behav.dat = get.behav.data('../s1s2_behavioural_data/final_data_cleaned_250ms_to_3_sdevs_1331_recode.csv')

data = inner_join(params, behav.dat, by=c("sub"))
data = data %>% mutate( pre_sing_total = Pre_VS + Pre_AS,
                        post_sing_total = Post_VS + Post_AS,
                        prct_down = ((post_sing_total/pre_sing_total)*100) )

```


```{r plot_corrs_functions, include=TRUE, echo=FALSE}
#### basic plot function to plot rts by parameter
draw.scatters <- function(data, dv){
  # enter the dataframe and the behavioural DV of choice to yield scatter plot of b_param by    dv
  scat = ggplot(data, aes_string(x="b", y=dv, col="con")) + 
         geom_point() +
         facet_wrap(~con) +
         geom_smooth(method=lm) +
         theme_bw() +
         theme(axis.line = element_line(colour = "black"),
         panel.grid.major = element_blank(),
         panel.grid.minor = element_blank(),
         panel.border = element_blank(),
         panel.background = element_blank())
          
 scat
}

draw.scatters.grp <- function(data, dv){
  # enter the dataframe and the behavioural DV of choice to yield scatter plot of b_param by    dv
  scat = ggplot(data, aes_string(x="b", y=dv, col="grp")) + 
         geom_point() +
         facet_wrap(~con) +
         theme_bw() +
         theme(axis.line = element_line(colour = "black"),
         panel.grid.major = element_blank(),
         panel.grid.minor = element_blank(),
         panel.border = element_blank(),
         panel.background = element_blank())
          
 scat
}


get.cors <- function(data, iv, dv, method){
  # pass in data frame, iv, dv, and method as tests to get outputs
  x = data$b[data$con == iv]
  y = data[data$con == iv, dv]
  test = cor.test(x, y, method=method)
  test
}
```


```{r CheckDists_MakeVars, echo=TRUE}

with(data, hist(prct_down, breaks = 20))
with(data, hist(b, breaks = 20))
with(data, boxplot(b))
```
Not too bad in terms of normality, but will use a spearman's correlation due to violation of normality assumptions


# params vs. Mu Sing Diff
```{r Grp_prct_down, echo=TRUE}
# 
draw.scatters.grp(data, "prct_down")
lapply(unique(data$con), get.cors, data = data, dv = "prct_down", method="spearman")
```
Sidak correction = 1-(1-.05)^(1/3) = .017
The correlation between lput_to_smfc and single task improvement is -vely correlated, the greater the improvement, the smaller the influence of practice on this connection

```{r Trn_Mu_Sing_Diff, echo=TRUE}
# 
draw.scatters.grp(data[data$grp == "train", ], "prct_down")
lapply(unique(data$con), get.cors, data = data[data$grp == "train", ], dv = "prct_down", method="spearman")
```

```{r Ctrl_Mu_Sing_Diff, echo=TRUE}
# 
draw.scatters.grp(data[data$grp == "control", ], "prct_down")
lapply(unique(data$con), get.cors, data = data[data$grp == "control", ], dv = "prct_down", method="spearman")
```
Again, none of the correlations meet the criteria for significance (Sidak adjust = .0169)
Although the controls tend to show a larger effect size than the practice group.
